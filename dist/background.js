(()=>{function o(){chrome.storage.local.set({booqsDictUserName:""}),chrome.storage.local.set({booqsDictIconUrl:""}),chrome.storage.local.set({booqsDictPublicUid:""}),chrome.storage.local.set({booqsDictToken:""})}chrome.action.onClicked.addListener((function(o){chrome.tabs.sendMessage(o.id,"Action")})),chrome.runtime.onMessage.addListener((function(o){switch(console.log("message"),o.action){case"openOptionsPage":chrome.runtime.openOptionsPage()}})),chrome.runtime.onConnect.addListener((function(e){e.onMessage.addListener((function(t){switch(t.action){case"isLoggedIn":!async function(e){const t=await new Promise((e=>{chrome.storage.local.get(["booqsDictToken"],(function(t){let n=t.booqsDictToken;if(n){let t="https://www.booqs.net/ja/api/v1/extension/is_logged_in?booqs_dict_token="+n,s={method:"POST",body:JSON.stringify({booqs_dict_token:n})};fetch(t,s).then((o=>o.json())).then((o=>{!function(o){chrome.storage.local.set({booqsDictUserName:o.name}),chrome.storage.local.set({booqsDictIconUrl:o.icon_url}),chrome.storage.local.set({booqsDictPublicUid:o.public_uid}),chrome.storage.local.set({booqsDictToken:o.token})}(o.data),e("loggedIn")})).catch((t=>{console.log(t),o(),e("error")}))}else o(),e("blankToken")}))}));e.postMessage({state:t})}(e);break;case"renderReviewForm":!async function(o,e){const t=await function(o){return new Promise((e=>{chrome.storage.local.get(["booqsDictToken"],(function(t){let n=t.booqsDictToken;if(!n)return e("unauthorized");fetch(`https://www.booqs.net/ja/api/v1/extension/review_setting?booqs_dict_token=${n}&word_id=${o}`,{method:"GET"}).then((o=>o.json())).then((o=>{console.log("success"),console.log(o),e(o.data)})).catch((o=>{console.log("error"),console.log(o),e(o)}))}))}))}(e);o.postMessage({data:t})}(e,t.wordId);break;case"createReminder":!async function(o,e,t){const n=await function(o,e){return new Promise((t=>{chrome.storage.local.get(["booqsDictToken"],(function(n){console.log(e);let s=n.booqsDictToken;if(!s)return t("unauthorized");let i=`https://www.booqs.net/ja/api/v1/extension/create_reminder?booqs_dict_token=${s}&quiz_id=${o}&setting_number=${e}`,c={method:"POST",body:JSON.stringify({booqs_dict_token:s,quiz_id:o,setting_number:e})};fetch(i,c).then((o=>o.json())).then((o=>{console.log(o),t(o)})).catch((o=>{console.log("create-error："+o),t(o)}))}))}))}(e,t);o.postMessage({data:n.data})}(e,t.quizId,t.settingNumber);break;case"updateReminder":!async function(o,e,t){const n=await function(o,e){return new Promise((t=>{chrome.storage.local.get(["booqsDictToken"],(function(n){let s=n.booqsDictToken;if(!s)return t("unauthorized");let i=`https://www.booqs.net/ja/api/v1/extension/update_reminder?booqs_dict_token=${s}&quiz_id=${o}&setting_number=${e}`,c={method:"POST",body:JSON.stringify({booqs_dict_token:s,quiz_id:o,setting_number:e})};fetch(i,c).then((o=>o.json())).then((o=>{console.log(o),t(o)})).catch((o=>{console.log("update-error："+o),t(o)}))}))}))}(e,t);o.postMessage({data:n.data})}(e,t.quizId,t.settingNumber);break;case"destroyReminder":!async function(o,e){const t=await function(o){return new Promise((e=>{chrome.storage.local.get(["booqsDictToken"],(function(t){let n=t.booqsDictToken;if(!n)return e("unauthorized");let s=`https://www.booqs.net/ja/api/v1/extension/destroy_reminder?booqs_dict_token=${n}&quiz_id=${o}`,i={method:"POST",body:JSON.stringify({booqs_dict_token:n,quiz_id:o})};fetch(s,i).then((o=>o.json())).then((o=>{console.log(o),e(o)})).catch((o=>{console.log("destroy-error："+o),e(o)}))}))}))}(e);o.postMessage({data:t.data})}(e,t.quizId)}}))}))})();