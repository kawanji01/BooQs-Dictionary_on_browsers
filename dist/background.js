(()=>{const e=chrome.i18n.getUILanguage().split("-")[0],t=`https://www.diqt.net/${["ja","en"].includes(e)?e:"ja"}`,o="Basic "+btoa(unescape(encodeURIComponent("4fc8087015e6bd355e48d5fee254822e6baa679e:2e187d8f2e6d5a324458e75b8e1c376f603a1b7d")));chrome.action.onClicked.addListener((function(e){chrome.tabs.sendMessage(e.id,"Action").then((e=>{})).catch((e=>{}))})),chrome.tabs.onUpdated.addListener((function(e){chrome.tabs.sendMessage(e,"Updated").then((e=>{})).catch((e=>{}))})),chrome.runtime.onMessage.addListener((function(e){switch(e.action){case"openOptionsPage":chrome.runtime.openOptionsPage()}})),chrome.runtime.onConnect.addListener((function(e){e.onMessage.addListener((function(n){switch(n.action){case"inspectCurrentUser":!async function(e){const n=await new Promise((e=>{fetch(`${t}/api/v1/extensions/users/current`,{method:"GET",mode:"cors",credentials:"include",dataType:"json",headers:{"Content-Type":"application/json;charset=utf-8",authorization:o}}).then((e=>e.json())).then((t=>{t.user?function(e){chrome.storage.local.set({diqtUserName:e.name}),chrome.storage.local.set({diqtUserIconUrl:e.icon_url}),chrome.storage.local.set({diqtUserPublicUid:e.public_uid}),chrome.storage.local.set({diqtPopupDisplayed:e.popup_displayed}),chrome.storage.local.set({diqtDictionaries:e.dictionaries})}(t.user):(chrome.storage.local.set({diqtUserName:""}),chrome.storage.local.set({diqtUserIconUrl:""}),chrome.storage.local.set({diqtUserPublicUid:""}),chrome.storage.local.set({diqtPopupDisplayed:""})),e(t)})).catch((t=>{console.log(t),e("error")}))}));e.postMessage({data:n})}(e);break;case"search":!async function(e,n){chrome.storage.local.get(["diqtSelectedDictionaryId"],(async function(a){let s=a.diqtSelectedDictionaryId;""!=s&&null!=s||(s=1,chrome.storage.local.set({diqtSelectedDictionaryId:`${s}`}));const c=await function(e,n){return new Promise((a=>{const s=`${t}/api/v1/extensions/dictionaries/${n}/search`,c={method:"POST",mode:"cors",credentials:"include",body:JSON.stringify({keyword:e}),dataType:"json",headers:{"Content-Type":"application/json;charset=utf-8",authorization:o}};fetch(s,c).then((e=>e.json())).then((e=>{a(e)})).catch((e=>{a(e)}))}))}(n,s);e.postMessage({data:c})}))}(e,n.keyword);break;case"createReview":!async function(e,n){const a=await function(e){return new Promise((n=>{const a=`${t}/api/v1/extensions/reviews`,s={method:"POST",mode:"cors",credentials:"include",body:JSON.stringify({quiz_id:e}),dataType:"json",headers:{"Content-Type":"application/json;charset=utf-8",authorization:o}};fetch(a,s).then((e=>e.json())).then((e=>{n(e)})).catch((e=>{console.log(e),n(e)}))}))}(n);e.postMessage({data:a})}(e,n.quizId);break;case"updateReview":!async function(e,n,a){const s=await function(e,n){return new Promise((a=>{const s=`${t}/api/v1/extensions/reviews/${e}`,c={method:"PATCH",mode:"cors",credentials:"include",body:JSON.stringify({interval_setting:n}),dataType:"json",headers:{"Content-Type":"application/json;charset=utf-8",authorization:o}};fetch(s,c).then((e=>e.json())).then((e=>{a(e)})).catch((e=>{console.log(e),a(e)}))}))}(n,a);e.postMessage({data:s})}(e,n.reviewId,n.settingNumber);break;case"destroyReview":!async function(e,n){const a=await function(e){return new Promise((n=>{fetch(`${t}/api/v1/extensions/reviews/${e}`,{method:"DELETE",mode:"cors",credentials:"include",dataType:"json",headers:{"Content-Type":"application/json;charset=utf-8",authorization:o}}).then((e=>e.json())).then((e=>{n(e)})).catch((e=>{console.log(e),n(e)}))}))}(n);e.postMessage({data:a})}(e,n.reviewId);break;case"googleTranslation":!async function(e,n){chrome.storage.local.get(["diqtSelectedDictionaryId"],(async function(a){let s=a.diqtSelectedDictionaryId;""!=s&&null!=s||(s=1,chrome.storage.local.set({diqtSelectedDictionaryId:`${s}`}));const c=await function(e,n){return new Promise((a=>{const s=`${t}/api/v1/extensions/dictionaries/${n}/google_translate`,c={method:"POST",mode:"cors",credentials:"include",body:JSON.stringify({keyword:e}),dataType:"json",headers:{"Content-Type":"application/json;charset=utf-8",authorization:o}};fetch(s,c).then((e=>e.json())).then((e=>{a(e)})).catch((e=>{console.log(e),a(e)}))}))}(n,s);e.postMessage({data:c})}))}(e,n.keyword);break;case"deeplTranslation":!async function(e,n){chrome.storage.local.get(["diqtSelectedDictionaryId"],(async function(a){let s=a.diqtSelectedDictionaryId;""!=s&&null!=s||(s=1,chrome.storage.local.set({diqtSelectedDictionaryId:`${s}`}));const c=await function(e,n){return new Promise((a=>{const s=`${t}/api/v1/extensions/dictionaries/${n}/deepl_translate`,c={method:"POST",mode:"cors",credentials:"include",body:JSON.stringify({keyword:e}),dataType:"json",headers:{"Content-Type":"application/json;charset=utf-8",authorization:o}};fetch(s,c).then((e=>e.json())).then((e=>{a(e)})).catch((e=>{console.log(e),a(e)}))}))}(n,s);e.postMessage({data:c})}))}(e,n.keyword)}}))}))})();