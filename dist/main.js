(()=>{function e(){let e=document.getElementById("diqt-dict-extension-wrapper");if(null==e){jsFrame=new JSFrame({horizontalAlign:"right"});const d='\n        <div id="diqt-dict-extension-wrapper">\n        <a>\n        <div id="diqt-dict-logged-in-user" style="font-size: 10px;">　</div>\n        </a>\n        <form method="get" action=""><input type="text" name="keyword" id="diqt-dict-search-form"></form>\n        <div id="diqt-dict-search-status" style="text-align: left; color: #6e6e6e;">\n        "<span id="diqt-dict-search-keyword" style="font-size: 12px;"></span>"<span id="diqt-dict-search-status-text"></span>\n        </div>\n        <div id="search-diqt-dict-results"></div>\n        </div>';let a=jsFrame.create({name:"diqt-dict-window",title:"Ctrl + Q で開閉",width:320,height:480,movable:!0,resizable:!0,appearanceName:"material",appearanceParam:{border:{shadow:"2px 2px 10px  rgba(0, 0, 0, 0.5)",width:0,radius:6},titleBar:{name:"diqt-dict-window-bar",color:"white",background:"#273132",leftMargin:16,height:30,fontSize:14,buttonWidth:36,buttonHeight:16,buttonColor:"white",buttons:[{fa:"fas fa-times",name:"closeButton",visible:!0}]}},style:{overflow:"auto"},html:d});a.setPosition(-20,100,["RIGHT_TOP"]),a.show();let r=document.querySelector("#diqt-dict-search-form");document.addEventListener("mouseup",(function(e){t(),e.stopPropagation()}),!1),(n=r).addEventListener("keyup",(function(){let e=n.value,t=document.querySelector("#diqt-dict-search-keyword").textContent;setTimeout((()=>{let n=document.querySelector("#diqt-dict-search-form").value;e==n&&e!=t&&e.length<1e3?i(e):e.length>=1e3&&(document.querySelector("#search-diqt-dict-results").innerHTML='<p style="color: #EE5A5A; font-size: 12px;">検索できるのは1000文字未満までです。</p>')}),500)})),function(e){e.addEventListener("keydown",(function(e){"Enter"==e.key&&e.preventDefault()}))}(r),e=a.$("#diqt-dict-extension-wrapper"),e.parentNode.parentNode.parentNode.parentNode.parentNode.style.zIndex="2147483647",t(),function(){let e=chrome.runtime.connect({name:"inspectCurrentUser"});e.postMessage({action:"inspectCurrentUser"}),e.onMessage.addListener((function(e){let t=document.querySelector("#diqt-dict-logged-in-user");e.data?chrome.storage.local.get(["diqtDictUserName"],(function(e){t.innerHTML=`<i class="fal fa-user"></i> ${e.diqtDictUserName}`})):t.innerHTML='<i class="fal fa-user"></i> ログインする'})),document.querySelector("#diqt-dict-logged-in-user").addEventListener("click",(function(){chrome.runtime.sendMessage({action:"openOptionsPage"})}))}()}else e.parentNode.parentNode.parentNode.parentNode.parentNode.remove();var n}function t(){const e=window.getSelection().toString();let t,n=document.querySelector("#diqt-dict-search-keyword");if(t=n?n.textContent:"",e.length>=1e3)document.querySelector("#search-diqt-dict-results").innerHTML='<p style="color: #EE5A5A; font-size: 12px;">検索できるのは1000文字未満までです。</p>';else if(""!=e&&t!=e&&e.length<1e3){let t=document.querySelector("#diqt-dict-search-form");t&&(t.value=e,i(e))}}function i(e){let t;document.querySelector("#diqt-dict-search-keyword").textContent=e,e.length<50&&e.length>0?document.querySelector("#diqt-dict-search-status-text").textContent="の検索結果":document.querySelector("#diqt-dict-search-status-text").textContent="",document.querySelector("#search-diqt-dict-results").innerHTML='<div class="center"><div class="lds-ripple-diqt-dict"><div></div><div></div></div></div>',t=e.length>50?encodeURIComponent(e.slice(0,50)):encodeURIComponent(e);let o=chrome.runtime.connect({name:"search"});o.postMessage({action:"search",keyword:t}),o.onMessage.addListener((function(e){!function(e){let t=document.querySelector("#search-diqt-dict-results");t.innerHTML="",chrome.storage.local.get(["diqtDictToken"],(function(o){let s=o.diqtDictToken;if(null!=e.data){e.data.forEach((function(e,i,d){let o,c=function(e){if(null==e)return'<div class="diqt-dict-word-tags-wrapper"></div>';let t=e.split(","),i=[];if(t.includes("ngsl")){let e='<a href="https://www.diqt.net/ja/chapters/c63ab6e5" target="_blank" rel="noopener" class="diqt-dict-word-tag"><i class="fal fa-tag"></i>基礎英単語</a>';i.push(e)}if(t.includes("nawl")){let e='<a href="https://www.diqt.net/ja/chapters/5cedf1da" target="_blank" rel="noopener" class="diqt-dict-word-tag"><i class="fal fa-tag"></i>学術頻出語</a>';i.push(e)}if(t.includes("tsl")){let e='<a href="https://www.diqt.net/ja/chapters/26c399f0" target="_blank" rel="noopener" class="diqt-dict-word-tag"><i class="fal fa-tag"></i>TOEIC頻出語</a>';i.push(e)}if(t.includes("bsl")){let e='<a href="https://www.diqt.net/ja/chapters/4d46ce7f" target="_blank" rel="noopener" class="diqt-dict-word-tag"><i class="fal fa-tag"></i>ビジネス頻出語</a>';i.push(e)}if(t.includes("phrase")){let e='<a href="https://www.diqt.net/ja/chapters/c112b566" target="_blank" rel="noopener" class="diqt-dict-word-tag"><i class="fal fa-tag"></i>頻出英熟語</a>';i.push(e)}if(t.includes("phave")){let e='<a href="https://www.diqt.net/ja/chapters/3623e0d5" target="_blank" rel="noopener" class="diqt-dict-word-tag"><i class="fal fa-tag"></i>頻出句動詞</a>';i.push(e)}return`<div class="diqt-dict-word-tags-wrapper">${i.join("")}</div>`}(e.tags),l=`https://www.diqt.net/ja/words/${e.id}`,u=`<div class="diqt-dict-entry">\n                                <span>${e.entry}</span><button class="diqt-dict-speech-btn"><i class="fas fa-volume-up"></i></button>\n                             </div>`,p='<div class="diqt-dict-meaning">'+e.meaning+"</div>",m=e.quiz.id;o=s?`<div class="diqt-dict-async-review-btn diqt-dict-review-btn" id="diqt-dict-review-${m}" style="font-weight: bold;"><i class="far fa-alarm-clock" style="margin-right: 4px;"></i>覚える</div><div class="diqt-dict-review-form" id="diqt-dict-review-form-${m}"></div>`:`<div class="diqt-dict-review-btn not-logged-in-review-btn-${e.id}" style="font-weight: bold;"><i class="far fa-alarm-clock" style="margin-right: 4px;"></i>覚える</div></a>`;let f="",g="";e.explanation&&(f='<div style="text-align: left; margin-top: 16px"><div class="diqt-dict-label">解説</div></div>',g=`<div class="diqt-dict-explanation">${a(e.explanation)}</div>`);let v="",q="",h="",w="",y="";e.sentence&&(v='<div style="text-align: left; margin-top: 16px"><div class="diqt-dict-label">例文</div></div>',q=`<div class="diqt-dict-explanation">${a(e.sentence.original)}</div><div class="diqt-dict-explanation">${e.sentence.translation}</div>`,h=e.sentence.quiz.id,w=s?`<div class="diqt-dict-async-review-btn diqt-dict-review-btn" id="diqt-dict-review-${h}" style="font-weight: bold;"><i class="far fa-alarm-clock" style="margin-right: 4px;"></i>例文を覚える</div><div class="diqt-dict-review-form" id="diqt-dict-review-form-${h}"></div>`:`<div class="diqt-dict-review-btn not-logged-in-review-btn-${e.id}" style="font-weight: bold;"><i class="far fa-alarm-clock" style="margin-right: 4px;"></i>例文を覚える</div></a>`,y=n(`https://www.diqt.net/ja/sentences/${e.id}`,"この例文を改善する"));let b=c+u+p+o+f+g+v+q+w+y+'<div style="width: 100%; height: 16px;"></div>'+n(l,"この項目を改善する")+'<div style="width: 100%; height: 24px;"></div>';t.insertAdjacentHTML("beforeend",b),s?function(e){let t=e.quiz.id,i=document.querySelector("#diqt-dict-review-"+t),n=i.nextSibling;if(i.addEventListener("click",(function(){n.innerHTML='<div class="center"><div class="lds-ripple-diqt-dict"><div></div><div></div></div></div>',r(t)})),null==e.sentence)return;let d=e.sentence.quiz.id,a=document.querySelector("#diqt-dict-review-"+d),o=a.nextSibling;a.addEventListener("click",(function(){o.innerHTML='<div class="center"><div class="lds-ripple-diqt-dict"><div></div><div></div></div></div>',r(d)}))}(e):document.querySelectorAll(`.not-logged-in-review-btn-${e.id}`).forEach((function(e,t,i){e.addEventListener("click",(function(){chrome.runtime.sendMessage({action:"openOptionsPage"})}))}))})),function(e){const t=e.querySelectorAll(".diqt-notation-link"),n=document.querySelector("#diqt-dict-search-form");t.forEach((function(e){e.addEventListener("click",(function(e){let t=e.target.dataset.value;return n.value!=t&&(n.value=t,i(t)),!1}))}))}(t),function(e){const t=e.querySelectorAll(".diqt-dict-speech-btn");speechSynthesis.getVoices(),t.forEach((function(e){e.addEventListener("click",(function(t){speechSynthesis.cancel();let i=e.previousElementSibling.textContent,n=new SpeechSynthesisUtterance,d=speechSynthesis.getVoices().find((function(e){return"Samantha"===e.name}));return n.voice=d,n.lang="en-US",n.volume=1,n.rate=1,n.pitch=1,n.text=i,speechSynthesis.speak(n),!1}))}))}(t);let o=document.querySelector("#diqt-dict-search-keyword").textContent;if(e.data[0].entry!=o){let e=d(o);t.insertAdjacentHTML("beforeend",e)}}else if(null==e.status){let e='<div class="diqt-dict-meaning" style="margin: 24px 0;">大変申し訳ございません。辞書にアクセスできませんでした。<a id="diqt-dict-option-btn" style="color: #27ae60;">こちら</a>にアクセスした後、再び検索してください。</div>';t.insertAdjacentHTML("afterbegin",e),document.querySelector("#diqt-dict-option-btn").addEventListener("click",(function(){chrome.runtime.sendMessage({action:"openOptionsPage"})}))}else{let e=document.querySelector("#diqt-dict-search-keyword").textContent;e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;");let i,n="";e.length<50&&e.length>0&&(n=d(e)),i=s?'<div id="diqt-dict-translation-form">\n                <div id="diqt-dict-google-translation"><div class="diqt-dict-review-btn" style="font-weight: bold;">Googleで翻訳する</div></div>\n                <div id="diqt-dict-deepl-translation"><div class="diqt-dict-review-btn" style="font-weight: bold;">DeepLで翻訳する</div></div>\n                </div>':'<div id="diqt-dict-translation-form">\n                <div id="diqt-dict-google-translation"><div class="diqt-dict-review-btn" style="font-weight: bold;">Googleで翻訳する</div></div>\n                <div id="diqt-dict-deepl-translation"><div class="diqt-dict-review-btn" style="font-weight: bold;">DeepLで翻訳する</div></div>\n                <p><a id="diqt-dict-login-for-translation" style="color: #27ae60;">ログイン</a>することで、機械翻訳が利用できるようになります。</p>\n                </div>';let a=n+i;t.insertAdjacentHTML("afterbegin",a),function(e,t){const i=document.querySelector("#diqt-dict-google-translation"),n=document.querySelector("#diqt-dict-deepl-translation");e?(i.addEventListener("click",(function(){i.innerHTML='<div class="center"><div class="lds-ripple-diqt-dict"><div></div><div></div></div></div>';let e=chrome.runtime.connect({name:"googleTranslation"});e.postMessage({action:"googleTranslation",keyword:t}),e.onMessage.addListener((function(e){let t=e.data;if("200"==t.status){let e=`<p style="font-size: 14px; color: #27ae60; margin-top: 24px;"><b>Google翻訳：</b></p>\n                    <p style="font-size: 14px; color: #6e6e6e; margin-bottom: 16px;">${t.data.translation}</p>`;i.innerHTML=e}else{let e=`<p style="margin: 24px 0;"><a href="https://www.diqt.net/ja/select_plan" target="_blank" rel="noopener" style="font-size: 14px; color: #27ae60;">${t.message}</a></p>`;i.innerHTML=e}}))})),n.addEventListener("click",(function(){n.innerHTML='<div class="center"><div class="lds-ripple-diqt-dict"><div></div><div></div></div></div>';let e=chrome.runtime.connect({name:"deeplTranslation"});e.postMessage({action:"deeplTranslation",keyword:t}),e.onMessage.addListener((function(e){let t=e.data;if("200"==t.status){let e=`<p style="font-size: 14px; color: #27ae60; margin-top: 24px;"><b>DeepL翻訳：</b></p>\n                    <p style="font-size: 14px; color: #6e6e6e; margin-bottom: 16px;">${t.data.translation}</p>`;n.innerHTML=e}else{let e=`<p style="margin: 24px 0;"><a href="https://www.diqt.net/ja/select_plan" target="_blank" rel="noopener" style="font-size: 14px; color: #27ae60;">${t.message}</a></p>`;n.innerHTML=e}}))}))):(i.addEventListener("click",(function(){chrome.runtime.sendMessage({action:"openOptionsPage"})})),n.addEventListener("click",(function(){chrome.runtime.sendMessage({action:"openOptionsPage"})})),document.querySelector("#diqt-dict-login-for-translation").addEventListener("click",(function(){chrome.runtime.sendMessage({action:"openOptionsPage"})})))}(s,e)}}))}(e.data)}))}function n(e,t){return`<div style="display: flex;">\n                    <a href="${e+"/edit"}" target="_blank" rel="noopener" class="diqt-dict-link-to-improve" style="margin-top: 0; margin-bottom: 8px; padding-top: 0; padding-bottom: 0;"><i class="fal fa-edit"></i>${t}</a>\n                    <a href="${e}" target="_blank" rel="noopener" class="diqt-dict-link-to-improve" style="margin-left: auto; margin-top: 0; margin-bottom: 8px; padding-top: 0; padding-bottom: 0;"><i class="fal fa-external-link" style="margin-right: 4px;"></i>詳細</a>\n                </div>`}function d(e){return`<div class="diqt-dict-meaning" style="margin: 24px 0;">${e}は辞書に登録されていません。</div><a href="https://www.diqt.net/ja/words/new?dict_uid=c6bbf748&text=${e}" target="_blank" rel="noopener" style="text-decoration: none;">\n                <div class="diqt-dict-review-btn" style="font-weight: bold;">辞書に登録する</div></a><a href="https://www.google.com/search?q=${e}+意味&oq=${e}+意味"" target="_blank" rel="noopener" style="text-decoration: none;">\n            <div class="diqt-dict-review-btn" style="font-weight: bold;">Webで検索する</div></a>`}function a(e){let t=e.replace(/\r?\n/g,"<br>").split(/(\[{2}.*?\]{2})/),i=[];return t.forEach((function(e,t,n){if(null==e.match(/\[{2}.+\]{2}/))i.push(e);else{let t;t=null==(e=(e=e.replace(/\[{2}/g,"").replace(/\]{2}/g,"")).split(/\|/,2))[1]?`<a class="diqt-notation-link" data-value="${e[0]}">${e[0]}</a>`:`<a class="diqt-notation-link" data-value="${e[1]}">${e[0]}</a>`,i.push(t)}})),i.join("")}function r(e){let t=document.querySelector("#diqt-dict-review-form-"+e),i=chrome.runtime.connect({name:"renderReviewForm"});i.postMessage({action:"renderReviewForm",quizId:e}),i.onMessage.addListener((function(e){let i=e.data;if("401"==i.status)t.innerHTML=`<p style="font-size: 12px; margin: 16px 0; color: #ee5a5aff;">${i.message}</p>`;else{let e=i.data;t.innerHTML=function(e){let t,i=e.quiz_id;return t=e.reminder_id?`\n        <div class="boqqs-dict-reminder-status">\n        <p>復習予定：${e.review_day}</p>\n        <p>復習設定：${o(e.setting)}に復習する</p>  \n        <div class="diqt-dict-destroy-review-btn" id="diqt-dict-destroy-review-btn-${i}"><i class="far fa-trash"></i> 復習設定を削除する</div>\n        </div>      \n<div class="diqt-dict-select-form cp_sl01">\n<select id="diqt-dict-select-form-${i}" style="height: 40px;" required>\n\t${s(e)}\n</select>\n</div>\n<button class="diqt-dict-submit-review-btn" id="diqt-dict-update-review-btn-${i}">設定する</button>\n<div class="diqt-dict-recommend-premium" id="diqt-dict-recommend-premium-${i}"></div>`:`      \n<div class="diqt-dict-select-form cp_sl01">\n<select id="diqt-dict-select-form-${i}" style="height: 40px;" required>\n\t${s(e)}\n</select>\n</div>\n<button class="diqt-dict-submit-review-btn" id="diqt-dict-create-review-btn-${i}">設定する</button>\n<div class="diqt-dict-recommend-premium" id="diqt-dict-recommend-premium-${i}"></div>`,t}(e),function(e){let t=e.quiz_id;e.reminder_id?(function(e){let t=document.querySelector("#diqt-dict-update-review-btn-"+e);t.addEventListener("click",(function(){t.textContent="設定中...";let i=document.querySelector("#diqt-dict-select-form-"+e).value,n=chrome.runtime.connect({name:"updateReminder"});n.postMessage({action:"updateReminder",quizId:e,settingNumber:i}),n.onMessage.addListener((function(e){let i=e.data;if("401"==i.status)return void(t.textContent=i.message);let n=i.data,d=document.querySelector("#diqt-dict-review-form-"+n.quiz_id);d.innerHTML="",d.previousSibling.innerHTML=`<i class="far fa-alarm-clock" style="margin-right: 4px;"></i>${o(n.setting)}に復習する`}))}))}(t),function(e){let t=document.querySelector(`#diqt-dict-destroy-review-btn-${e}`);t.addEventListener("click",(function(){t.textContent="設定中...";let i=chrome.runtime.connect({name:"destroyReminder"});i.postMessage({action:"destroyReminder",quizId:e}),i.onMessage.addListener((function(e){let i=e.data;if("401"==i.status)return void(t.textContent=i.message);let n=i.data,d=document.querySelector("#diqt-dict-review-form-"+n.quiz_id);d.innerHTML="",d.previousSibling.innerHTML='<i class="far fa-alarm-clock" style="margin-right: 4px;"></i>覚える'}))}))}(t)):function(e){let t=document.querySelector("#diqt-dict-create-review-btn-"+e);t.addEventListener("click",(function(){t.textContent="設定中...";let i=document.querySelector("#diqt-dict-select-form-"+e).value,n=chrome.runtime.connect({name:"createReminder"});n.postMessage({action:"createReminder",quizId:e,settingNumber:i}),n.onMessage.addListener((function(e){let i=e.data;if("401"==i.status)return void(t.textContent=i.message);let n=i.data,d=document.querySelector("#diqt-dict-review-form-"+n.quiz_id);d.innerHTML="",d.previousSibling.innerHTML=`<i class="far fa-alarm-clock" style="margin-right: 4px;"></i>${o(n.setting)}に復習する`}))}))}(t),"false"==e.premium&&function(e){const t=document.querySelector(`#diqt-dict-recommend-premium-${e}`),i=t.previousElementSibling,n=document.querySelector(`#diqt-dict-select-form-${e}`);let d=Number(n.value);const a='<p>プレミアム会員になることで、復習を自由に設定できるようになります！</p>\n    <p><a href="https://www.diqt.net/ja/select_plan" target="_blank" rel="noopener"><i class="far fa-crown"></i> プレミアムプランの詳細を見る</a></p>';0!=d&&(i.classList.add("hidden"),t.innerHTML=a),n.addEventListener("change",(function(){d=Number(this.value),0==d?(i.classList.remove("hidden"),t.innerHTML=""):(i.classList.add("hidden"),t.innerHTML=a)}))}(t)}(e)}}))}function o(e){let t="";switch(e=Number(e)){case 0:t="明日";break;case 1:t="3日後";break;case 2:t="１週間後";break;case 3:t="２週間後";break;case 4:t="３週間後";break;case 5:t="１ヶ月後";break;case 6:t="２ヶ月後";break;case 7:t="３ヶ月後";break;case 8:t="６ヶ月後";break;case 9:t="1年後"}return t}function s(e){let t=0;e.setting&&(t=Number(e.setting));let i="";for(let n=0;n<10;n++){let d="";0!=n&&"false"==e.premium&&(d="🔒 "),i+=n==t?`<option value="${n}" selected>${d}${o(n)}に復習する</option>`:`<option value="${n}">${d}${o(n)}に復習する</option>`}return i}chrome.runtime.onMessage.addListener((function(t,i,n){switch(t){case"Action":e();break;case"Updated":chrome.storage.local.get(["diqtDictPopupDisplayed"],(function(t){if(!1===t.diqtDictPopupDisplayed||""===t.diqtDictPopupDisplayed)return;document.addEventListener("selectionchange",(()=>{const t=document.querySelector("#diqt-dict-extension-wrapper"),i=window.getSelection().toString();let n=document.querySelector("#diqt-dict-popup-to-display-window");if(n&&n.remove(),null==t&&""!=i){const t=window.getSelection().getRangeAt(0),i=document.createRange();if(0==t.endOffset)return;i.setStart(t.endContainer,t.endOffset-1),i.setEnd(t.endContainer,t.endOffset);const d=i.getBoundingClientRect();if(0==d.top&&0==d.left)return;const a=`<button id="diqt-dict-popup-to-display-window" style="position: absolute; width: 32px; height: 32px; background-color: #273132; top: ${window.pageYOffset+d.top+32}px; left: ${window.pageXOffset+d.left}px; z-index: 2147483647; border: 0; border-radius: 4px; padding: 0; margin: 0;">\n                    <img src="https://kawanji.s3.ap-northeast-1.amazonaws.com/assets/diqt_logo.svg" alt="diqt Icon" style="height: 24px;width: 24px; margin: 4px 2px 2px 3px; padding: 0;">\n                    </button>`;document.querySelector("html body").insertAdjacentHTML("beforeend",a),n=document.querySelector("button#diqt-dict-popup-to-display-window"),n.addEventListener("click",(function(){e(),n.remove()}))}}))}))}})),document.addEventListener("keydown",(t=>{if(t.ctrlKey)switch(t.key){case"q":e()}}))})();