(()=>{function e(){const e=window.getSelection().toString(),o=document.querySelector("#booqs-dict-search-keyword").textContent;if(""!=e&&o!=e&&e.length<50){let o=document.querySelector("#booqs-dict-search-form");o.value=e,console.log(o.value),t(e)}}function t(e){document.querySelector("#booqs-dict-search-keyword").textContent=e,document.querySelector("#search-booqs-dict-results").innerHTML='<div class="center"><div class="lds-ripple-booqs-dict"><div></div><div></div></div></div>';let o=encodeURIComponent(e);fetch("https://www.booqs.net/api/v1/extension/search?keyword="+o,{method:"GET"}).then((e=>e.json())).then((e=>{!function(e){console.log(e.data);let o=document.querySelector("#search-booqs-dict-results");if(o.innerHTML="",null!=e.data)e.data.forEach((function(e,n,a){console.log(e,n);let s=function(e){if(null==e)return'<div class="booqs-dict-word-tags-wrapper"></div>';let t=e.split(","),o=[];if(t.includes("ngsl")){let e='<a href="https://www.booqs.net/ja/chapters/c63ab6e5" target="_blank" rel="noopener" class="booqs-dict-word-tag"><i class="fal fa-tag"></i>基礎英単語</a>';o.push(e)}if(t.includes("nawl")){let e='<a href="https://www.booqs.net/ja/chapters/5cedf1da" target="_blank" rel="noopener" class="booqs-dict-word-tag"><i class="fal fa-tag"></i>学術頻出語</a>';o.push(e)}if(t.includes("tsl")){let e='<a href="https://www.booqs.net/ja/chapters/26c399f0" target="_blank" rel="noopener" class="booqs-dict-word-tag"><i class="fal fa-tag"></i>TOEIC頻出語</a>';o.push(e)}if(t.includes("bsl")){let e='<a href="https://www.booqs.net/ja/chapters/4d46ce7f" target="_blank" rel="noopener" class="booqs-dict-word-tag"><i class="fal fa-tag"></i>ビジネス頻出語</a>';o.push(e)}if(t.includes("phrase")){let e='<a href="https://www.booqs.net/ja/chapters/c112b566" target="_blank" rel="noopener" class="booqs-dict-word-tag"><i class="fal fa-tag"></i>頻出英熟語</a>';o.push(e)}if(t.includes("phave")){let e='<a href="https://www.booqs.net/ja/chapters/3623e0d5" target="_blank" rel="noopener" class="booqs-dict-word-tag"><i class="fal fa-tag"></i>頻出句動詞</a>';o.push(e)}return`<div class="booqs-dict-word-tags-wrapper">${o.join("")}</div>`}(e.tags),i='<div class="booqs-dict-entry">'+e.entry+"</div>",r='<div class="booqs-dict-meaning">'+e.meaning+"</div>",c='<div class="booqs-dict-explanation">'+function(e){let t=e.replace(/\r?\n/g,"<br>").split(/(\[{2}.*?\]{2})/),o=[];return t.forEach((function(e,t,n){if(null==e.match(/\[{2}.+\]{2}/))o.push(e);else{let t;t=null==(e=(e=e.replace(/\[{2}/g,"").replace(/\]{2}/g,"")).split(/\|/,2))[1]?`<a class="booqs-notation-link" data-value="${e[0]}">${e[0]}</a>`:`<a class="booqs-notation-link" data-value="${e[1]}">${e[0]}</a>`,o.push(t)}})),o.join("")}(e.explanation)+"</div>",l=`https://www.booqs.net/ja/words/${e.id}`,d=s+i+r+c+`<a href="${l}?type=review" target="_blank" rel="noopener"><div class="booqs-dict-review-btn">復習する</div></a>`+`<a href="${l+"/edit"}" target="_blank" rel="noopener" class="booqs-dict-link-to-improve">この項目を改善する</a>`;o.insertAdjacentHTML("beforeend",d),function(e){let o=e.querySelectorAll(".booqs-notation-link"),n=document.querySelector("#booqs-dict-search-form");o.forEach((function(e){e.addEventListener("click",(function(e){let o=e.target.dataset.value;return n.value!=o&&(n.value=o,t(o)),!1}))}))}(o)}));else{let e=document.querySelector("#booqs-dict-search-keyword").textContent;e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;");let t=`<div class="booqs-dict-meaning" style="margin: 24px 0;">${e}は辞書に登録されていません。</div><a href="https://www.booqs.net/ja/words/new?dict_uid=c6bbf748&text=${e}" target="_blank" rel="noopener"><div class="booqs-dict-review-btn" style="font-weight: bold;">辞書に登録する</div></a>`;o.insertAdjacentHTML("afterbegin",t)}}(e)})).catch((e=>{console.log(e)}))}chrome.runtime.onMessage.addListener((function(o,n,a){"Action"==o&&function(){let o=document.getElementById("booqs-dict-extension-wrapper");if(null==o){jsFrame=new JSFrame({horizontalAlign:"right"});const a='\n        <div id="booqs-dict-extension-wrapper">\n        <a>\n        <div id="booqs-dict-logged-in-user">　</div>\n        </a>\n        <form method="get" action=""><input type="text" name="keyword" id="booqs-dict-search-form"></form>\n        <div id="booqs-dict-search-status">\n        "<span id="booqs-dict-search-keyword"></span>"<span id="booqs-dict-search-status-text">の検索結果</span>\n        </div>\n        <div id="search-booqs-dict-results"></div>\n        </div>';let s=jsFrame.create({name:"booqs-dict-window",title:"BooQs Dictionary",width:320,height:480,movable:!0,resizable:!0,appearanceName:"material",appearanceParam:{border:{shadow:"2px 2px 10px  rgba(0, 0, 0, 0.5)",width:0,radius:6},titleBar:{name:"booqs-dict-window-bar",color:"white",background:"#273132",leftMargin:16,height:30,fontSize:14,buttonWidth:36,buttonHeight:16,buttonColor:"white",buttons:[{fa:"fas fa-times",name:"closeButton",visible:!0}]}},style:{overflow:"auto"},html:a});s.setPosition(-20,100,["RIGHT_TOP"]),s.show();let i=document.querySelector("#booqs-dict-search-form");document.addEventListener("mouseup",(function(t){e(),t.stopPropagation()}),!1),(n=i).addEventListener("keyup",(function(){let e=n.value,o=document.querySelector("#booqs-dict-search-keyword").textContent;setTimeout((()=>{let n=document.querySelector("#booqs-dict-search-form").value;e==n&&e!=o&&e.length<50&&t(e)}),500)})),function(e){e.addEventListener("keydown",(function(e){"Enter"==e.key&&e.preventDefault()}))}(i),o=s.$("#booqs-dict-extension-wrapper"),o.parentNode.parentNode.parentNode.parentNode.parentNode.style.zIndex="2147483647",e(),function(){let e=chrome.runtime.connect({name:"verifyLoggedIn"});e.postMessage({action:"isLoggedIn"}),e.onMessage.addListener((function(e){let t=document.querySelector("#booqs-dict-logged-in-user");"loggedIn"==e.state?chrome.storage.local.get(["booqsDictUserName"],(function(e){t.innerHTML=`<i class="fal fa-user"></i> ${e.booqsDictUserName}`})):t.innerHTML='<i class="fal fa-user"></i> ログインする'})),document.querySelector("#booqs-dict-logged-in-user").addEventListener("click",(function(){chrome.runtime.sendMessage({action:"openOptionsPage"})}))}()}else o.parentNode.parentNode.parentNode.parentNode.parentNode.remove();var n}()}))})();