(()=>{const e=chrome.i18n.getUILanguage().split("-")[0],n=`https://www.diqt.net/${["ja","en"].includes(e)?e:"ja"}`,t="Basic "+btoa(unescape(encodeURIComponent("4fc8087015e6bd355e48d5fee254822e6baa679e:2e187d8f2e6d5a324458e75b8e1c376f603a1b7d")));function s(){let e="",s="",o="",c="",l="";chrome.storage.local.get(["diqtUserPublicUid","diqtUserIconUrl","diqtUserName","diqtSelectedDictionaryId","diqtPopupDisplayed","diqtDictionaries"],(function(r){e=r.diqtUserPublicUid,s=r.diqtUserIconUrl,o=r.diqtUserName,c=r.diqtSelectedDictionaryId,l=r.diqtPopupDisplayed,""==c||null==c?(c=1,chrome.storage.local.set({diqtSelectedDictionaryId:`${c}`})):c=Number(c);let d="";l&&(d="checked");const p=`\n<div class="content has-text-centered">\n  \n    <figure class="mt-5 image is-128x128 mx-auto">\n      <img\n        class="is-rounded"\n        src="${s}"\n      />\n    </figure>\n\n    <h1 class="mt-3 is-size-4 has-text-weight-bold">\n      ${o}\n    </h1>\n\n    ${function(e,n){console.log(e);return`<div class="block has-text-centered mt-5">\n    <div class="select">\n        <select id="dictionary-select-form">\n            ${JSON.parse(e).map((e=>function(e,n){const t=e[0]===n?"selected":"";return`<option value="${e[0]}" class="has-text-weight-bold" ${t}>${e[1]}</option>`}(e,n))).join("")}\n        </select>\n    </div>\n</div>`}(r.diqtDictionaries,c)}\n\n    <div class="block has-text-centered">\n        <a href="${n}" target="_blank" rel="noopener">\n            <button class="button is-warning is-light">${chrome.i18n.getMessage("addOrRemoveDictionaries")}</button>\n        </a>\n    </div>\n    \n\n    <dic class="block my-3">\n        <label class="checkbox" id="diqt-dict-popup-displayed">\n            <input type="checkbox" id="diqt-dict-popup-displayed-checkbox" ${d}>\n            <span id="diqt-dict-popup-displayed-text">${chrome.i18n.getMessage("displayPopup")}</span>\n        </label>\n    </div>\n\n    \n  \n<div class="block has-text-centered">\n  <a href="${n}/users/${e}" target="_blank" rel="noopener">\n  <button class="button is-warning is-light">${chrome.i18n.getMessage("myPage")}</button>\n  </a>\n</div>\n\n<div class="block has-text-centered">\n  <button class="button is-warning is-light" id="logout-btn">${chrome.i18n.getMessage("logOut")}</button>\n</div>\n\n</div>`;document.querySelector("#user-page").innerHTML=p,document.getElementById("dictionary-select-form").addEventListener("change",(function(e){const n=`${e.currentTarget.value}`;chrome.storage.local.set({diqtSelectedDictionaryId:n})})),function(){const e=document.querySelector("#logout-btn");e.addEventListener("click",(()=>{e.value=chrome.i18n.getMessage("loggingOut"),fetch(`${n}/api/v1/extensions/sessions/logout`,{method:"POST",mode:"cors",credentials:"include",dataType:"json",headers:{"Content-Type":"application/json;charset=utf-8",authorization:t}}).then((e=>e.json())).then((e=>{chrome.storage.local.set({diqtUserName:""}),chrome.storage.local.set({diqtUserIconUrl:""}),chrome.storage.local.set({diqtUserPublicUid:""}),chrome.storage.local.set({diqtPopupDisplayed:""}),a(),i()})).catch((e=>{console.log(e)}))}),!1)}(),function(){const e=document.querySelector("#diqt-dict-popup-displayed"),s=document.querySelector("#diqt-dict-popup-displayed-checkbox"),a=document.querySelector("#diqt-dict-popup-displayed-text");e.addEventListener("click",(()=>{a.textContent=chrome.i18n.getMessage("nowSetting"),fetch(`${n}/api/v1/extensions/users/update_popup_displayed`,{method:"POST",mode:"cors",credentials:"include",dataType:"json",headers:{"Content-Type":"application/json;charset=utf-8",authorization:t}}).then((e=>e.json())).then((e=>{s.checked=e.data.popup_displayed,a.textContent=chrome.i18n.getMessage("displayPopup"),chrome.storage.local.set({diqtPopupDisplayed:e.data.popup_displayed})})).catch((e=>{console.log(e)}))}),!1)}()}))}function a(){const e=`\n<div class="content">\n<h1 class="mb-5 mt-3 has-text-centered is-size-2 has-text-weight-bold">\n  ${chrome.i18n.getMessage("loginTitle")}\n</h1>\n<p>\n${chrome.i18n.getMessage("loginDescription")}\n</p>\n\n</div>\n\n<form class="fetchForm">\n<div id="feedback">\n</div>\n<div class="field">\n  <label class="label">Email</label>\n  <div class="control">\n    <input\n      class="input"\n      id="diqt-email"\n      type="email"\n      placeholder="${chrome.i18n.getMessage("emailPlaceholder")}"\n      value=""\n    />\n  </div>\n</div>\n\n<div class="field">\n  <label class="label">Password</label>\n  <div class="control">\n    <input\n      class="input"\n      id="diqt-password"\n      type="password"\n      placeholder="${chrome.i18n.getMessage("passwordPlaceholder")}"\n      value=""\n    />\n  </div>\n</div>\n<input\n  type="button"\n  value="${chrome.i18n.getMessage("login")}"\n  class="button is-success has-text-weight-bold is-block is-medium mt-5"\n  id="diqt-login-btn"\n  style="width: 100%"\n/>\n</form>\n<p>　</p>\n<h5 class="mb-3 mt-5 has-text-centered is-size-4 has-text-grey">\n<span class="has-text-weight-light">———</span> or <span class="has-text-weight-light">———</span>\n</h3>\n<div class="columns has-text-centered">\n  <div class="column is-three-fifths is-offset-one-fifth">\n    <a href="${n}/login?authentication=sns" target="_blank" rel="noopener">\n        <button class="button is-danger my-3 is-medium is-fullwidth has-text-weight-bold">${chrome.i18n.getMessage("continueWithGoogle")}</button>\n    </a>\n\n    <a href="${n}/login?authentication=sns" target="_blank" rel="noopener">\n        <button class="button is-black my-3 is-medium is-fullwidth has-text-weight-bold">${chrome.i18n.getMessage("continueWithApple")}</button>\n    </a>\n\n    <p>　</p>\n    <p class="my-5 has-text-weight-bold">\n    ${chrome.i18n.getMessage("noAccount")} <a href="${n}/users/new" target="_blank" rel="noopener" style="color: #f79c4f;">${chrome.i18n.getMessage("signUp")}</a>\n    </p>\n\n\n  </div>\n</div>\n\n`;document.querySelector("#user-page").innerHTML=e,i()}function i(){document.querySelector("#diqt-login-btn").addEventListener("click",(()=>{const e=document.querySelector("#diqt-email").value,a=document.querySelector("#diqt-password").value,i=`${n}/api/v1/extensions/sessions/sign_in`,o={method:"POST",mode:"cors",credentials:"include",body:JSON.stringify({email:e,password:a}),dataType:"json",headers:{"Content-Type":"application/json;charset=utf-8",authorization:t}};fetch(i,o).then((e=>e.json())).then((e=>{if("200"==e.status)!function(e){chrome.storage.local.set({diqtUserName:e.name}),chrome.storage.local.set({diqtUserIconUrl:e.icon_url}),chrome.storage.local.set({diqtUserPublicUid:e.public_uid}),chrome.storage.local.set({diqtPopupDisplayed:e.popup_displayed})}(e.data),s();else{const e=`\n                    <div class="notification is-danger is-light my-3">\n                    ${chrome.i18n.getMessage("wrongCombination")}\n                    </div>`;document.querySelector("#feedback").innerHTML=e}})).catch((e=>{console.log(e)}))}),!1)}!function(){const e=chrome.runtime.connect({name:"inspectCurrentUser"});e.postMessage({action:"inspectCurrentUser"}),e.onMessage.addListener((function(e){200==e.data.status?s():a()}))}(),document.querySelector("#app-name").textContent=chrome.i18n.getMessage("appName"),function(){const e=document.querySelector("#app-links");let n=`\n    <a href="${chrome.i18n.getMessage("appStoreUrl")}" target="_blank" rel="nofollow"\n        class="appreach__aslink"><img src="${chrome.i18n.getMessage("appStoreImage")}"></a>\n    <a href="${chrome.i18n.getMessage("playStoreUrl")}" target="_blank" rel="nofollow"\n        class="appreach__gplink"><img src="${chrome.i18n.getMessage("playStoreImage")}"></a>`;const t=` \n    <h5 class="mb-5 mt-3 has-text-centered has-text-weight-bold">\n    ${chrome.i18n.getMessage("appLinksTitle")}\n  </h5>\n\n  <div class="appreach">\n    <img\n      src="https://is2-ssl.mzstatic.com/image/thumb/Purple112/v4/5f/68/68/5f68681f-631e-d7c8-8d1c-bb964ff65aed/AppIcon-0-0-1x_U007emarketing-0-0-0-7-0-0-sRGB-0-0-0-GLES2_U002c0-512MB-85-220-0-0.png/512x512bb.jpg"\n      alt="DiQt" class="appreach__icon">\n    <div class="appreach__detail">\n      <p class="appreach__name">DiQt</p>\n      <p class="appreach__info"><span class="appreach__price">${chrome.i18n.getMessage("free")}</span></p>\n      <p class="appreach__star">\n        <span class="appreach__star__base">★★★★★</span><span class="appreach__star__evaluate"\n          style="width: 90%;">★★★★★</span>\n      </p>\n    </div>\n    <div class="appreach__links">\n        ${n}\n    </div>\n  </div>`;e.innerHTML=t}(),function(){const e=document.querySelector("#diqt-footer"),t=`\n    <div class="content has-text-centered has-text-light">\n      <div class="columns">\n        <div class="column">\n          <div class="my-2">\n            <a href="${n}" target="_blank" rel="noopener" class="has-text-success-light">${chrome.i18n.getMessage("aboutDiQt")}</a>\n          </div>\n\n          <div class="my-2">\n            <a href="${chrome.i18n.getMessage("chromeWebStoreUrl")}"\n              target="_blank" rel="noopener" class="has-text-success-light">${chrome.i18n.getMessage("storePage")}</a>\n          </div>\n\n          \n\n          <div class="my-2">\n            <a href="${n}/about" target="_blank" rel="noopener"\n              class="has-text-success-light">${chrome.i18n.getMessage("company")}</a>\n          </div>\n\n          <div class="my-2">\n            <a href="${n}/contact" target="_blank" rel="noopener"\n              class="has-text-success-light">${chrome.i18n.getMessage("contact")}</a>\n          </div>\n\n          <div class="my-2">\n            <a href="${n}/legal" target="_blank" rel="noopener"\n                class="has-text-success-light">${chrome.i18n.getMessage("legal")}</a>\n          </div>\n\n          <div class="my-2">\n            <a href="${n}/terms_of_service" target="_blank" rel="noopener"\n              class="has-text-success-light">${chrome.i18n.getMessage("termsOfService")}</a>\n          </div>\n\n          <div class="my-2">\n            <a href="${n}/privacy_policy" target="_blank" rel="noopener"\n              class="has-text-success-light">${chrome.i18n.getMessage("privacyPolicy")}</a>\n          </div>\n\n        </div>\n      </div>\n    </div>\n    `;e.innerHTML=t}()})();