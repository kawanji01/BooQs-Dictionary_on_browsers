const diqtRootUrl="https://www.diqt.net";function initializePage(){let t=chrome.runtime.connect({name:"inspectCurrentUser"});t.postMessage({action:"inspectCurrentUser"}),t.onMessage.addListener((function(t){t.data?renderMypage():renderLoginForm()}))}function setUserData(t){chrome.storage.local.set({diqtDictUserName:t.name}),chrome.storage.local.set({diqtDictIconUrl:t.icon_url}),chrome.storage.local.set({diqtDictPublicUid:t.public_uid}),chrome.storage.local.set({diqtDictToken:t.token}),chrome.storage.local.set({diqtDictPopupDisplayed:t.popup_displayed})}function resetUserData(){chrome.storage.local.set({diqtDictUserName:""}),chrome.storage.local.set({diqtDictIconUrl:""}),chrome.storage.local.set({diqtDictPublicUid:""}),chrome.storage.local.set({diqtDictToken:""}),chrome.storage.local.set({diqtDictPopupDisplayed:""})}function renderMypage(){let t="",e="",n="",i="",o="";chrome.storage.local.get(["diqtDictPublicUid","diqtDictIconUrl","diqtDictUserName","diqtDictDictionaryId","diqtDictPopupDisplayed"],(function(s){t=s.diqtDictPublicUid,e=s.diqtDictIconUrl,n=s.diqtDictUserName,i=s.diqtDictDictionaryId,o=s.diqtDictPopupDisplayed,""==i?(i=1,chrome.storage.local.set({diqtDictDictionaryId:`${i}`})):i=Number(i);let a="";o&&(a="checked");let c=`\n<div class="content has-text-centered">\n  \n    <figure class="mt-5 image is-128x128 mx-auto">\n      <img\n        class="is-rounded"\n        src="${e}"\n      />\n    </figure>\n\n    <h1 class="mt-3 is-size-4 has-text-weight-bold">\n      ${n}\n    </h1>\n\n    ${createDictionarySelectForm(i)}\n    \n\n    <dic class="block my-3">\n        <label class="checkbox" id="diqt-dict-popup-displayed">\n            <input type="checkbox" id="diqt-dict-popup-displayed-checkbox" ${a}>\n            <span id="diqt-dict-popup-displayed-text">テキストを選択したときにポップアップを表示する。</span>\n        </label>\n    </div>\n\n    \n  \n<div class="block has-text-centered">\n  <a href="https://www.diqt.net/ja/users/${t}" target="_blank" rel="noopener">\n  <button class="button is-warning is-light">マイページ</button>\n  </a>\n</div>\n\n<div class="block has-text-centered">\n  <button class="button is-warning is-light" id="logout-btn">ログアウト</button>\n</div>\n\n</div>`;document.querySelector("#user-page").innerHTML=c,addEventToSelectForm(),addEventToLogout(),AddEventToPopupDisplayed()}))}function createDictionarySelectForm(t){let e=function(t,e){return t===e?"selected":""};return`<div class="block has-text-centered mt-5">\n    <div class="select">\n        <select id="dictionary-select-form">\n            <option value="1" class="has-text-weight-bold" ${e(1,t)}>英和辞書</option>\n            <option value="5" class="has-text-weight-bold" ${e(5,t)}>英英辞書</option>\n        </select>\n    </div>\n</div>`}function addEventToSelectForm(){document.getElementById("dictionary-select-form").addEventListener("change",(function(t){let e=`${t.currentTarget.value}`;chrome.storage.local.set({diqtDictDictionaryId:e})}))}function addEventToLogout(){let t=document.querySelector("#logout-btn");t.addEventListener("click",(()=>{t.value="ログアウト中...",fetch(`${diqtRootUrl}/ja/api/v1/extensions/sessions/logout`,{method:"POST",mode:"cors",credentials:"include",dataType:"json",headers:{"Content-Type":"application/json;charset=utf-8"}}).then((t=>t.json())).then((t=>{resetUserData(),renderLoginForm(),addEventToLoginForm()})).catch((t=>{console.log(t)}))}),!1)}function AddEventToPopupDisplayed(){let t=document.querySelector("#diqt-dict-popup-displayed"),e=document.querySelector("#diqt-dict-popup-displayed-checkbox"),n=document.querySelector("#diqt-dict-popup-displayed-text");t.addEventListener("click",(()=>{n.textContent="設定中...",fetch(`${diqtRootUrl}/ja/api/v1/extensions/users/update_popup_displayed`,{method:"POST",mode:"cors",credentials:"include",dataType:"json",headers:{"Content-Type":"application/json;charset=utf-8"}}).then((t=>t.json())).then((t=>{e.checked=t.data.popup_displayed,n.textContent="テキストを選択したときにポップアップを表示する。",chrome.storage.local.set({diqtDictPopupDisplayed:t.data.popup_displayed})})).catch((t=>{console.log(t)}))}),!1)}function renderLoginForm(){document.querySelector("#user-page").innerHTML='\n<div class="content">\n<h1 class="mb-5 mt-3 has-text-centered is-size-2 has-text-weight-bold">\n  ログイン\n</h1>\n<p>\n  ログインすることで、復習を設定できるようになったり、機械翻訳が利用できるようになります。\n</p>\n\n</div>\n\n<form class="fetchForm">\n<div id="feedback">\n</div>\n<div class="field">\n  <label class="label">Email</label>\n  <div class="control">\n    <input\n      class="input"\n      id="diqt-email"\n      type="email"\n      placeholder="メールアドレスを入力してください。"\n      value=""\n    />\n  </div>\n</div>\n\n<div class="field">\n  <label class="label">Password</label>\n  <div class="control">\n    <input\n      class="input"\n      id="diqt-password"\n      type="password"\n      placeholder="パスワードを入力してください。"\n      value=""\n    />\n  </div>\n</div>\n<input\n  type="button"\n  value="ログインする"\n  class="button is-success has-text-weight-bold is-block is-medium mt-5"\n  id="diqt-login-btn"\n  style="width: 100%"\n/>\n</form>\n<p>　</p>\n<h5 class="mb-3 mt-5 has-text-centered is-size-4 has-text-grey">\n<span class="has-text-weight-light">———</span> or <span class="has-text-weight-light">———</span>\n</h3>\n<div class="columns has-text-centered">\n  <div class="column is-three-fifths is-offset-one-fifth">\n    <a href="https://www.diqt.net/ja/login?authentication=sns" target="_blank" rel="noopener">\n        <button class="button is-danger my-3 is-medium is-fullwidth has-text-weight-bold">Googleで続ける</button>\n    </a>\n\n    <a href="https://www.diqt.net/ja/login?authentication=sns" target="_blank" rel="noopener">\n        <button class="button is-info my-3 is-medium is-fullwidth has-text-weight-bold">Twitterで続ける</button>\n    </a>\n\n    <a href="https://www.diqt.net/ja/login?authentication=sns" target="_blank" rel="noopener">\n        <button class="button is-black my-3 is-medium is-fullwidth has-text-weight-bold">Appleで続ける</button>\n    </a>\n\n    <p>　</p>\n    <p class="my-5 has-text-weight-bold">\n        アカウントを持っていませんか？ <a href="https://www.diqt.net/ja/users/new" target="_blank" rel="noopener" style="color: #f79c4f;">新規登録</a\n        >\n    </p>\n\n\n  </div>\n</div>\n\n',addEventToLoginForm()}function addEventToLoginForm(){document.querySelector("#diqt-login-btn").addEventListener("click",(()=>{let t=document.querySelector("#diqt-email").value,e=document.querySelector("#diqt-password").value,n=`${diqtRootUrl}/ja/api/v1/extensions/sessions/sign_in`,i={method:"POST",mode:"cors",credentials:"include",body:JSON.stringify({email:t,password:e}),dataType:"json",headers:{"Content-Type":"application/json;charset=utf-8"}};fetch(n,i).then((t=>t.json())).then((t=>{if("200"==t.status)setUserData(t.data),renderMypage();else{let t='\n                    <div class="notification is-danger is-light my-3">\n                    メールアドレスとパスワードの組み合わせが正しくありません。\n                    </div>';document.querySelector("#feedback").innerHTML=t}})).catch((t=>{console.log(t)}))}),!1)}initializePage();