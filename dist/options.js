function inspectState(){return new Promise((o=>{chrome.storage.local.get(["booqsDictToken"],(function(e){let n=e.booqsDictToken;if(console.log(n),n){console.log(n);let e="https://www.booqs.net/ja/api/v1/extension/is_logged_in?booqs_dict_token="+n,t={method:"POST",body:JSON.stringify({booqs_dict_token:n})};fetch(e,t).then((o=>o.json())).then((e=>{console.log(e),setUserData(e.data),o("loggedIn")})).catch((e=>{console.log(e),resetUserData(),o("error")}))}else resetUserData(),o("blankToken")}))}))}async function initializePage(){"loggedIn"==await inspectState()?renderProfile():renderLoginForm()}function setUserData(o){chrome.storage.local.set({booqsDictUserName:o.name}),chrome.storage.local.set({booqsDictIconUrl:o.icon_url}),chrome.storage.local.set({booqsDictPublicUid:o.public_uid}),chrome.storage.local.set({booqsDictToken:o.token})}function resetUserData(){chrome.storage.local.set({booqsDictUserName:""}),chrome.storage.local.set({booqsDictIconUrl:""}),chrome.storage.local.set({booqsDictPublicUid:""}),chrome.storage.local.set({booqsDictToken:""})}function renderProfile(){let o="",e="",n="";chrome.storage.local.get(["booqsDictPublicUid","booqsDictIconUrl","booqsDictUserName"],(function(t){console.log(t.booqsDictUserName),o=t.booqsDictPublicUid,e=t.booqsDictIconUrl,n=t.booqsDictUserName;let s=`\n<div class="content has-text-centered">\n  <a href="https://www.booqs.net/ja/users/${o}" target="_blank" rel="noopener">\n    <figure class="mt-5 image is-128x128 mx-auto">\n      <img\n        class="is-rounded"\n        src="${e}"\n      />\n    </figure>\n\n    <h1 class="mt-3 is-size-4 has-text-weight-bold">\n      ${n}\n    </h1>\n  </a>\n  <button class="button is-warning is-light mx-auto my-3" id="logout-btn">ログアウト</button>\n</div>`;document.querySelector("#user-page").innerHTML=s,addEventToProfile()}))}function addEventToProfile(){document.querySelector("#logout-btn").addEventListener("click",(()=>{chrome.storage.local.get(["booqsDictToken"],(function(o){let e=o.booqsDictToken;console.log(e);let n="https://www.booqs.net/ja/api/v1/extension/log_out?booqs_dict_token="+e,t={method:"POST",body:JSON.stringify({booqs_dict_token:e})};fetch(n,t).then((o=>o.json())).then((o=>{resetUserData(),renderLoginForm(),addEventToLoginForm()})).catch((o=>{console.log(o)}))}))}),!1)}function renderLoginForm(){document.querySelector("#user-page").innerHTML='\n<div class="content">\n<h1 class="mb-5 mt-3 has-text-centered is-size-2 has-text-weight-bold">\n  ログインフォーム\n</h1>\n<p>\n  ログインすることで、拡張機能から直接復習を設定できるようになります。\n</p>\n<p>\n  まだBooQsにアカウントを登録されていない方は、<a href="">こちら</a\n  >よりご登録ください。\n</p>\n</div>\n\n<form class="fetchForm">\n<div class="field">\n  <label class="label">Email</label>\n  <div class="control">\n    <input\n      class="input"\n      id="booqs-email"\n      type="email"\n      placeholder="Email input"\n      value="sakushahushou@gmail.com"\n    />\n  </div>\n</div>\n\n<div class="field">\n  <label class="label">Password</label>\n  <div class="control">\n    <input\n      class="input"\n      id="booqs-password"\n      type="password"\n      placeholder="Text input"\n      value="foobar"\n    />\n  </div>\n</div>\n<input\n  type="button"\n  value="送信"\n  class="button is-primary is-link is-bloc"\n  id="booqs-login-btn"\n  style="width: 100%"\n/>\n</form>',addEventToLoginForm()}function addEventToLoginForm(){document.querySelector("#booqs-login-btn").addEventListener("click",(()=>{console.log("clickBtn");let o=document.querySelector("#booqs-email").value,e=document.querySelector("#booqs-password").value,n=`https://www.booqs.net/ja/api/v1/extension/sign_in?email=${o}&password=${e}`,t={method:"POST",mode:"cors",credentials:"include",body:JSON.stringify({email:o,password:e})};fetch(n,t).then((o=>o.json())).then((o=>{console.log(o),setUserData(o.data),renderProfile()})).catch((o=>{console.log(o)}))}),!1)}initializePage();